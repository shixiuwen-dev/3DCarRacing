<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrazyGames é¡µé¢åˆ†æå·¥å…·</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="max-w-6xl mx-auto p-8">
        <h1 class="text-3xl font-bold mb-8">CrazyGames é¡µé¢åˆ†æå·¥å…·</h1>
        
        <div class="bg-gray-800 rounded-lg p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">è¾“å…¥è¦åˆ†æçš„é¡µé¢</h2>
            <div class="flex gap-4 items-center">
                <input type="text" id="urlInput" 
                       value="https://www.crazygames.com/c/action"
                       placeholder="è¾“å…¥CrazyGamesé¡µé¢URL"
                       class="flex-1 px-4 py-2 rounded bg-gray-700 text-white border border-gray-600">
                <button onclick="analyzePage()" 
                        class="px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded text-white">
                    åˆ†æé¡µé¢
                </button>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- åŸºæœ¬ä¿¡æ¯ -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-bold mb-4">é¡µé¢åŸºæœ¬ä¿¡æ¯</h3>
                <div id="basicInfo" class="space-y-2 text-sm font-mono">
                    <div>ç­‰å¾…åˆ†æ...</div>
                </div>
            </div>
            
            <!-- é“¾æ¥ç»Ÿè®¡ -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-bold mb-4">é“¾æ¥ç»Ÿè®¡</h3>
                <div id="linkStats" class="space-y-2 text-sm font-mono">
                    <div>ç­‰å¾…åˆ†æ...</div>
                </div>
            </div>
        </div>
        
        <!-- æ‰¾åˆ°çš„æ¸¸æˆé“¾æ¥ -->
        <div class="bg-gray-800 rounded-lg p-6 mt-8">
            <h3 class="text-lg font-bold mb-4">æ‰¾åˆ°çš„æ¸¸æˆé“¾æ¥</h3>
            <div id="gameLinks" class="space-y-1 text-sm font-mono max-h-96 overflow-y-auto">
                <div>ç­‰å¾…åˆ†æ...</div>
            </div>
        </div>
        
        <!-- HTMLç»“æ„åˆ†æ -->
        <div class="bg-gray-800 rounded-lg p-6 mt-8">
            <h3 class="text-lg font-bold mb-4">HTMLç»“æ„åˆ†æ</h3>
            <div id="htmlAnalysis" class="text-sm font-mono max-h-96 overflow-y-auto bg-gray-700 p-4 rounded">
                <div>ç­‰å¾…åˆ†æ...</div>
            </div>
        </div>
    </div>

    <script>
        async function analyzePage() {
            const url = document.getElementById('urlInput').value.trim();
            if (!url) {
                alert('è¯·è¾“å…¥URL');
                return;
            }
            
            const basicInfo = document.getElementById('basicInfo');
            const linkStats = document.getElementById('linkStats');
            const gameLinks = document.getElementById('gameLinks');
            const htmlAnalysis = document.getElementById('htmlAnalysis');
            
            // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
            basicInfo.innerHTML = '<div class="text-blue-400">æ­£åœ¨åˆ†æ...</div>';
            linkStats.innerHTML = '<div class="text-blue-400">æ­£åœ¨åˆ†æ...</div>';
            gameLinks.innerHTML = '<div class="text-blue-400">æ­£åœ¨åˆ†æ...</div>';
            htmlAnalysis.innerHTML = '<div class="text-blue-400">æ­£åœ¨åˆ†æ...</div>';
            
            try {
                // é€šè¿‡ä»£ç†è·å–é¡µé¢
                const proxyUrl = `http://localhost:3007/proxy?url=${encodeURIComponent(url)}`;
                const response = await fetch(proxyUrl);
                const html = await response.text();
                
                // è§£æHTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // åŸºæœ¬ä¿¡æ¯
                const title = doc.title || 'No title';
                const htmlLength = html.length;
                const allLinks = doc.querySelectorAll('a').length;
                const allImages = doc.querySelectorAll('img').length;
                
                basicInfo.innerHTML = `
                    <div><span class="text-green-400">é¡µé¢æ ‡é¢˜:</span> ${title}</div>
                    <div><span class="text-green-400">HTMLé•¿åº¦:</span> ${htmlLength.toLocaleString()} å­—ç¬¦</div>
                    <div><span class="text-green-400">æ€»é“¾æ¥æ•°:</span> ${allLinks}</div>
                    <div><span class="text-green-400">æ€»å›¾ç‰‡æ•°:</span> ${allImages}</div>
                    <div><span class="text-green-400">å“åº”çŠ¶æ€:</span> ${response.status}</div>
                `;
                
                // åˆ†ææ¸¸æˆé“¾æ¥
                const gameLinksFound = [];
                const linkSelectors = [
                    'a[href*="/game/"]',
                    '[href*="/game/"]'
                ];
                
                                 // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾
                 const regexMatches = html.match(/href="[^"]*\/game\/[^"]*"/g) || [];
                 
                 // ä½¿ç”¨é€‰æ‹©å™¨æŸ¥æ‰¾
                 const selectorMatches = [];
                 linkSelectors.forEach(selector => {
                     const elements = doc.querySelectorAll(selector);
                     elements.forEach(el => {
                         const href = el.getAttribute('href');
                         if (href && href.includes('/game/')) {
                             selectorMatches.push(href);
                         }
                     });
                 });
                 
                 // ä¸“é—¨æŸ¥æ‰¾ cursed-treasure-2
                 const cursedTreasureFound = html.includes('cursed-treasure-2');
                 const cursedTreasureRegex = html.match(/[^"]*cursed-treasure-2[^"]*/g) || [];
                 
                 console.log('ğŸ” ä¸“é—¨æŸ¥æ‰¾ cursed-treasure-2:');
                 console.log('HTMLä¸­æ˜¯å¦åŒ…å«:', cursedTreasureFound);
                 console.log('æ­£åˆ™åŒ¹é…ç»“æœ:', cursedTreasureRegex);
                
                // æ¸…ç†å’Œåˆå¹¶é“¾æ¥
                const allGameLinks = [...regexMatches, ...selectorMatches];
                const cleanGameLinks = [];
                
                allGameLinks.forEach(link => {
                    let cleanLink = link;
                    if (cleanLink.startsWith('href="')) {
                        cleanLink = cleanLink.substring(6, cleanLink.length - 1);
                    }
                    if (cleanLink.startsWith('/')) {
                        cleanLink = 'https://www.crazygames.com' + cleanLink;
                    }
                    if (!cleanGameLinks.includes(cleanLink) && cleanLink.includes('/game/')) {
                        cleanGameLinks.push(cleanLink);
                    }
                });
                
                                 // é“¾æ¥ç»Ÿè®¡
                 linkStats.innerHTML = `
                     <div><span class="text-green-400">æ­£åˆ™è¡¨è¾¾å¼æ‰¾åˆ°:</span> ${regexMatches.length} ä¸ª</div>
                     <div><span class="text-green-400">é€‰æ‹©å™¨æ‰¾åˆ°:</span> ${selectorMatches.length} ä¸ª</div>
                     <div><span class="text-green-400">å»é‡åæ€»è®¡:</span> ${cleanGameLinks.length} ä¸ª</div>
                     <div><span class="text-green-400">åŒ…å«/game/çš„é“¾æ¥:</span> ${cleanGameLinks.filter(l => l.includes('/game/')).length} ä¸ª</div>
                     <div><span class="text-yellow-400">åŒ…å«cursed-treasure-2:</span> ${cursedTreasureFound ? 'Yes' : 'No'}</div>
                     <div><span class="text-yellow-400">cursed-treasure-2åŒ¹é…:</span> ${cursedTreasureRegex.length} ä¸ª</div>
                 `;
                
                // æ˜¾ç¤ºæ¸¸æˆé“¾æ¥
                if (cleanGameLinks.length > 0) {
                    gameLinks.innerHTML = cleanGameLinks.map((link, index) => 
                        `<div class="text-green-400">${index + 1}. ${link}</div>`
                    ).join('');
                } else {
                    gameLinks.innerHTML = '<div class="text-red-400">æœªæ‰¾åˆ°ä»»ä½•æ¸¸æˆé“¾æ¥</div>';
                }
                
                // HTMLç»“æ„åˆ†æ
                const bodyContent = doc.body ? doc.body.innerHTML.substring(0, 2000) : 'No body found';
                const scripts = doc.querySelectorAll('script').length;
                const divs = doc.querySelectorAll('div').length;
                const articles = doc.querySelectorAll('article').length;
                const gameClasses = doc.querySelectorAll('[class*="game"]').length;
                
                htmlAnalysis.innerHTML = `
                    <div><span class="text-green-400">è„šæœ¬æ•°é‡:</span> ${scripts}</div>
                    <div><span class="text-green-400">DIVå…ƒç´ :</span> ${divs}</div>
                    <div><span class="text-green-400">ARTICLEå…ƒç´ :</span> ${articles}</div>
                    <div><span class="text-green-400">åŒ…å«'game'çš„class:</span> ${gameClasses}</div>
                    <div class="mt-4 text-gray-400">é¡µé¢å†…å®¹é¢„è§ˆ (å‰2000å­—ç¬¦):</div>
                    <div class="mt-2 text-xs text-gray-300 whitespace-pre-wrap">${bodyContent.substring(0, 2000)}...</div>
                `;
                
            } catch (error) {
                const errorMsg = `åˆ†æå¤±è´¥: ${error.message}`;
                basicInfo.innerHTML = `<div class="text-red-400">${errorMsg}</div>`;
                linkStats.innerHTML = `<div class="text-red-400">${errorMsg}</div>`;
                gameLinks.innerHTML = `<div class="text-red-400">${errorMsg}</div>`;
                htmlAnalysis.innerHTML = `<div class="text-red-400">${errorMsg}</div>`;
                console.error('åˆ†æé”™è¯¯:', error);
            }
        }
    </script>
</body>
</html> 